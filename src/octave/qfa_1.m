function y=qfa(f,a,b,patience=10,epsz=1e-12,wanna_print=false)
  _qfc=[
  0.0051282051282051282051282051282051281759
  0.048699387295088238550645108490909649756
  0.097820391676052159128537348618992594511
  0.13966507849560431803157492542792136238
  0.17560578900106674676537594695346634661
  0.20205146748238357363676732792567368935
  0.21888151163057340179839439673523336642
  0.22429633858205286776715348143919572482
  0.21888151163057340179839439673523336641
  0.20205146748238357363676732792567368937
  0.17560578900106674676537594695346634660
  0.13966507849560431803157492542792136237
  0.097820391676052159128537348618992594505
  0.048699387295088238550645108490909649754
  0.0051282051282051282051282051282051281921
  ] ;
  _qfxx=[
  -1.0000000000000000000000000000000000000
  -0.99371220989324258353314824194737869715
  -0.97492791218182360701813168299393121723
  -0.94388333030836756289526360715103662152
  -0.90096886790241912623610231950744505116
  -0.84672419922828416835277581626296527151
  -0.78183148246802980870844452667405775024
  -0.70710678118654752440084436210484903929
  -0.62348980185873353052500488400423981064
  -0.53203207651533656355763036723037073017
  -0.43388373911755812047576833284835875461
  -0.33027906195516708177487761259657237031
  -0.22252093395631440428890256449679475947
  -0.11196447610330785846870593527202420326
  0
  0.11196447610330785846870593527202420326
  0.22252093395631440428890256449679475947
  0.33027906195516708177487761259657237031
  0.43388373911755812047576833284835875461
  0.53203207651533656355763036723037073017
  0.62348980185873353052500488400423981063
  0.70710678118654752440084436210484903928
  0.78183148246802980870844452667405775023
  0.84672419922828416835277581626296527151
  0.90096886790241912623610231950744505116
  0.94388333030836756289526360715103662152
  0.97492791218182360701813168299393121723
  0.99371220989324258353314824194737869715
  1.0000000000000000000000000000000000000
  ] ;
  _qfcc=[
  0.0012771392081736909323116219667943805384
  0.012261863082965059183757260672587997397
  0.025073542949876119982835702556885437729
  0.037003488124485205952410988595758198919
  0.048714184513998659016006832920198121119
  0.059671722500291530510800360039061795198
  0.069971720188124901715360725785693207337
  0.079324399141810206291234242539439122598
  0.087731808647660728388301226283541406525
  0.094993231127670812935868864274475598423
  0.10109644009839900606731621967353236674
  0.10589618899078746036382490403487686430
  0.10939348026402093482773831077366493146
  0.11148767663607657022825919082719761136
  0.11220622905131822720794709811258591222
  0.11148767663607657022825919082719761137
  0.10939348026402093482773831077366493147
  0.10589618899078746036382490403487686430
  0.10109644009839900606731621967353236673
  0.094993231127670812935868864274475598407
  0.087731808647660728388301226283541406539
  0.079324399141810206291234242539439122596
  0.069971720188124901715360725785693207342
  0.059671722500291530510800360039061795189
  0.048714184513998659016006832920198121113
  0.037003488124485205952410988595758198910
  0.025073542949876119982835702556885437708
  0.012261863082965059183757260672587997395
  0.0012771392081736909323116219667943805590
  ] ;
  if a==b
    y=0 ; return ;
  end
  if a==-inf && b==inf
    y=qfa(@(x)f(x./(1-x.^2)).*(1+x.^2)./(1-x.^2).^2,-1,1,patience,epsz,wanna_print) ;
    return ;
  end
  if isfinite(a) && b==inf
    y=qfa(@(x)f(a+x./(1-x))./(1-x).^2,0,1,patience,epsz,wanna_print) ;
    return ;
  end
  if a==-inf && isfinite(b)
    y=qfa(@(x)f(b-x./(1-x))./(1-x).^2,0,1,patience,epsz,wanna_print) ;
    return ;
  end
  id=@(x)merge(isfinite(x),x,zeros(size(x))) ;
  f=@(x)id(f(x)) ;
  if wanna_print
    printf("a=%f,b=%f,patience=%d\n",a,b,patience)
  end
  if a==b 
    y=0*f((a+b)/2) ;
    return
  end
  fxx=f((a+b)/2+(b-a)/2*_qfxx) ;
  fx=fxx(2*(1:length(_qfc))-1) ;
  H=(b-a)/2*sum(_qfcc.*fxx) ;
  L=(b-a)/2*sum(_qfc.*fx) ;
  y=H ; 
  if all(abs(L-H)(:)<epsz)
    return
  end
  if patience>0
    m=(a+b)/2 ;
    y=qfa(f,a,m,patience-1,epsz,wanna_print)+ ...
      qfa(f,m,b,patience-1,epsz,wanna_print) ;
  end
end

%{
	This method of numerical quadrature should be adequate if the
	integrand is holomorphic in a complex neighborhood of the compact
	segment of integration.  It is not prepared for singular integrals.

	Sample run.

(12:52) gp > default(parisizemax,1g)
  ***   Warning: new maximum stack size = 1000000000 (953.674 Mbytes).
(12:52) gp > intnum(x=0,sqrt(2),sin(34*cos(12*Pi*x)),9)
  ***   Warning: increasing stack size to 16000000.
%5 = 0.0013958465440407288112814894719777562586
(12:52) gp > intnum(x=0,sqrt(2),sin(34*cos(12*Pi*x)),10)
  ***   Warning: increasing stack size to 16000000.
  ***   Warning: increasing stack size to 32000000.
%6 = 0.0013958465440407288112814894719777562564
(12:52) gp >

global c
function y = id (x)
  global c
  c += numel (x);
  y = x;
endfunction

>> f=@(x)sin(34*cos(12*pi*x));a=0;b=sqrt(2);I=0.0013958465440407288112814894719777562564;c=0;qfa(@(x)f(id(x)),a,b)-I,c
ans = -2.7712e-16
c = 12267
>>
>> qfa(f=@(x)abs(x-0.123),a=0,b=1)-0.392129
ans = -6.2523e-11
>> qfa(f=@(x)abs(x-0.123),a=0,b=1,20)-0.392129
ans = 1.8502e-13
>> qfa(f=@(x)abs(x-0.123),a=0,b=1,20,1e-16)-0.392129
ans = -5.5511e-17
>> qfa(@(x)exp(x).*cos(x),0,pi/2)-0.5*(-1+exp(0.5*pi))
ans = -4.4409e-16
>> qfa(@(x)exp(-pi*x.^2),-inf,inf)-1
ans = 0
>> qfa(@sqrt,0,1)-2/3
ans = -1.5170e-10
>> qfa(@sqrt,0,1,30,1e-16)-2/3
ans = -1.1102e-16
>> qfa(@(x)1./sqrt(x),0,1)
ans = 1.9982
>> qfa(@(x)1./sqrt(x),0,1)-2
ans = -1.8255e-03
>> qfa(@(x)1./sqrt(x),0,1,30,1e-16)-2
ans = -1.7827e-06
>> qfa(@(x)1./sqrt(x),0,1,100,1e-16)-2
ans = 0
>> qfa(@(x)exp(-3*x).*cos(2*x),0,inf)-3/13
ans = -5.5511e-17
>> qfa(@(x)abs(x-12).*exp(-abs(x-12)),-inf,inf)-2
ans = -4.8775e-05
>> qfa(@(x)abs(x-12).*exp(-abs(x-12)),-inf,inf,30,1e-16)-2
ans = -4.4409e-16
>> qfa(@(x)1./(1+x.^2),-inf,inf)-pi
ans = -4.9888e-06
>> qfa(@(x)1./(1+x.^2),-inf,inf,50,1e-16)-pi
ans = 0
>> qfa(@(x)1./(1+x.^2),0,inf)-pi/2
ans = -6.2360e-07
>> qfa(@(x)1./(1+x.^2),0,inf,50,1e-16)-pi/2
ans = 0
>> qfa(@(x)1./(1+x.^2),0,1)-pi/4
ans = 2.2204e-16
>> qfa(@(x)x.*log(x),0,1)-(-1/4)
ans = 4.2077e-14
>> qfa(@(x)x.*log(x),0,1,20,1e-16)-(-1/4)
ans = 0
>> qfa(@(x)log(abs(x-0.123)),0,1)-(-1.372859970960925)
ans = -2.2678e-05
>> qfa(@(x)log(abs(x-0.123)),0,1,50,1e-16)-(-1.372859970960925)
ans = 4.2188e-15
>> qfa(@(x)log(abs(x-0.123)),0,1,50,1e-17)-(-1.372859970960925)
ans = 0
>> qfa(@(x)x.^-0.25,0,1)-4/3
ans = -3.3388e-05
>> qfa(@(x)x.^-0.25,0,1,60,1e-16)-4/3
ans = -2.2204e-16
%	Terrible struggle begin
>> qfa(@(x)x.^-0.75,0,1)-4
ans = -0.1241
>> max_recursion_depth (2^16)
>> qfa(@(x)x.^-0.75,0,1,200,1e-16)-4
ans = -8.8818e-16
%	Terrible struggle end
>> global c
>> function y = id (x)
  global c
  c += numel (x);
  y = x;
endfunction
>> n=1600;i=(0:n-1).' ; a=randn(n,1) ; b=rand(n,1)+i ; f=@(x)arrayfun(@(xi)sum(a.*cos(b.*xi),1),x) ; F=@(x)sum(a.*sin(b.*x)./b); c=0;qfa (@(x)f(id(x)),a=0,b=2*pi)-(F(b)-F(a)) , plot(xx=linspace(a,b,1000),f(xx)) , c
ans = 3.6887e-14
c = 59363
>> qfa(@(x)sqrt(1-x.^2),-1,1)-pi/2
ans = -1.2136e-09
>> qfa(@(x)sqrt(1-x.^2),-1,1,30,1e-16)-pi/2
ans = 0
>> dblquad (@(x,y)exp(-pi*(x.^2+y.^2)),-4,4,-4,4,:,@(f,a,b,t)qfa(f,a,b,3,1e-12))-1
ans = 0
>> dblquad (@(x,y)exp(-pi*(x.^2+y.^2)),-inf,inf,-inf,inf,:,@(f,a,b,t)qfa(f,a,b,3,1e-12))-1
ans = 0
>> dblquad (@(x,y)1./(1-x.*y),0,1,0,1,:,@(f,a,b,t)qfa(f,a,b,25,1e-12))-pi^2/6
ans = -4.3555e-11
>> dblquad (@(x,y)1./(1-x.*y),0,1,0,1,:,:)-pi^2/6
warning: quadcc: Error tolerance not met.  Estimated error: 7.29043
ans = 2.9461e-08
>> dblquad (@(x,y)1./(1+x.*y),0,1,0,1,:,:)-pi^2/12
ans = 0
>> dblquad (@(x,y)1./(1+x.*y),0,1,0,1,:,@(f,a,b,t)qfa(f,a,b,3,1e-12))-pi^2/12
ans = 1.1102e-16
%}
