qfa(f,a=0,b=1,patience=10,epsz=1E-30,wanna_print=0)=my(qfx15=[-1.0000000000000000000000000000000000000000000000000000000000000000000000000000,-0.97492791218182360701813168299393121723278580061999743764807957508764593163441,-0.90096886790241912623610231950744505116591916213185715005356242319943242042795,-0.78183148246802980870844452667405775023233451870868752898063495804509173163393,-0.62348980185873353052500488400423981063227473089640210536554943909685365245651,-0.43388373911755812047576833284835875460999072778745987644454730353220325165319,-0.22252093395631440428890256449679475946635556876454495531198701589742123202854,0.E-76,0.22252093395631440428890256449679475946635556876454495531198701589742123202854,0.43388373911755812047576833284835875460999072778745987644454730353220325165319,0.62348980185873353052500488400423981063227473089640210536554943909685365245649,0.78183148246802980870844452667405775023233451870868752898063495804509173163393,0.90096886790241912623610231950744505116591916213185715005356242319943242042794,0.97492791218182360701813168299393121723278580061999743764807957508764593163440,1.0000000000000000000000000000000000000000000000000000000000000000000000000000],qfc15=[0.0051282051282051282051282051282051282051282051282051282051282051282051282051506,0.048699387295088238550645108490909649765822729124870986888050082203867468205093,0.097820391676052159128537348618992594539911238569265212213958804185425874658155,0.13966507849560431803157492542792136243373766747757577774301484039632406949037,0.17560578900106674676537594695346634666073713791324763601399330723916847460266,0.20205146748238357363676732792567368944799839381348650844506529638717030681006,0.21888151163057340179839439673523336649165931582517945946435558088309795843239,0.22429633858205286776715348143919572491001062429633858205286776715348143919616,0.21888151163057340179839439673523336649165931582517945946435558088309795843240,0.20205146748238357363676732792567368944799839381348650844506529638717030681002,0.17560578900106674676537594695346634666073713791324763601399330723916847460271,0.13966507849560431803157492542792136243373766747757577774301484039632406949039,0.097820391676052159128537348618992594539911238569265212213958804185425874658183,0.048699387295088238550645108490909649765822729124870986888050082203867468205076,0.0051282051282051282051282051282051282051282051282051282051282051282051282051700],qfx29=[-1.0000000000000000000000000000000000000000000000000000000000000000000000000000,-0.99371220989324258353314824194737869715263549578207321492775650215951038096889,-0.97492791218182360701813168299393121723278580061999743764807957508764593163441,-0.94388333030836756289526360715103662152063246819031638184372537432131943503758,-0.90096886790241912623610231950744505116591916213185715005356242319943242042795,-0.84672419922828416835277581626296527151004502879136388045969998621506742539677,-0.78183148246802980870844452667405775023233451870868752898063495804509173163393,-0.70710678118654752440084436210484903928483593768847403658833986899536623923104,-0.62348980185873353052500488400423981063227473089640210536554943909685365245651,-0.53203207651533656355763036723037073016458395550868788519773530449413472352989,-0.43388373911755812047576833284835875460999072778745987644454730353220325165319,-0.33027906195516708177487761259657237031318146903007475937654372224352506879546,-0.22252093395631440428890256449679475946635556876454495531198701589742123202854,-0.11196447610330785846870593527202420325819642296748011503386259286909941450000,0.E-76,0.11196447610330785846870593527202420325819642296748011503386259286909941450000,0.22252093395631440428890256449679475946635556876454495531198701589742123202854,0.33027906195516708177487761259657237031318146903007475937654372224352506879548,0.43388373911755812047576833284835875460999072778745987644454730353220325165319,0.53203207651533656355763036723037073016458395550868788519773530449413472352990,0.62348980185873353052500488400423981063227473089640210536554943909685365245649,0.70710678118654752440084436210484903928483593768847403658833986899536623923106,0.78183148246802980870844452667405775023233451870868752898063495804509173163393,0.84672419922828416835277581626296527151004502879136388045969998621506742539679,0.90096886790241912623610231950744505116591916213185715005356242319943242042794,0.94388333030836756289526360715103662152063246819031638184372537432131943503758,0.97492791218182360701813168299393121723278580061999743764807957508764593163440,0.99371220989324258353314824194737869715263549578207321492775650215951038096889,1.0000000000000000000000000000000000000000000000000000000000000000000000000000],qfc29=[0.0012771392081736909323116219667943805874840357598978288633461047254150702424260,0.012261863082965059183757260672587997427196696612589505431495230948481334372955,0.025073542949876119982835702556885437814032292226846501561468289685968564890409,0.037003488124485205952410988595758199064024520575470741373829459275868011263878,0.048714184513998659016006832920198121319455654863963277684092893896387424570754,0.059671722500291530510800360039061795444904762891042486272148965060796346242495,0.069971720188124901715360725785693207644413464092630390121369776534832252639044,0.079324399141810206291234242539439122925354157371938839453644633982373118110619,0.087731808647660728388301226283541406911413618203365386853536419058394010372919,0.094993231127670812935868864274475598828232710075470018346767564238950737230102,0.10109644009839900606731621967353236715077948917940534035868783567257324422255,0.10589618899078746036382490403487686475725022225660268541704956735713657071154,0.10939348026402093482773831077366493193221157966869648528062395357434716314423,0.11148767663607657022825919082719761184677894809683463813673763149910141717705,0.11220622905131822720794709811258591269293569625049174969040334897874946956708,0.11148767663607657022825919082719761184677894809683463813673763149910141717715,0.10939348026402093482773831077366493193221157966869648528062395357434716314426,0.10589618899078746036382490403487686475725022225660268541704956735713657071157,0.10109644009839900606731621967353236715077948917940534035868783567257324422258,0.094993231127670812935868864274475598828232710075470018346767564238950737230078,0.087731808647660728388301226283541406911413618203365386853536419058394010372947,0.079324399141810206291234242539439122925354157371938839453644633982373118110655,0.069971720188124901715360725785693207644413464092630390121369776534832252639020,0.059671722500291530510800360039061795444904762891042486272148965060796346242521,0.048714184513998659016006832920198121319455654863963277684092893896387424570714,0.037003488124485205952410988595758199064024520575470741373829459275868011263880,0.025073542949876119982835702556885437814032292226846501561468289685968564890341,0.012261863082965059183757260672587997427196696612589505431495230948481334372981,0.0012771392081736909323116219667943805874840357598978288633461047254150702425147],(div(x,y)=if((-oo<x)&&(x<+oo)&&(-oo<y)&&(y<+oo)&&(0!=y),x/y,0)),fxx,fx,H,L);if(a==b,return(0));if(a>b,return(-qfa(f,b,a,patience,epsz,wanna_print)));if((a==-oo)&&(b==+oo),return(qfa(x->f(div(x,1-x^2))*div(1+x^2,(1-x^2)^2),-1,1,patience,epsz,wanna_print)));if((-oo<a)&&(a<+oo)&&(b==+oo),return(qfa(x->div(f(a+div(x,(1-x))),(1-x)^2),0,1,patience,epsz,wanna_print)));if((a==-oo)&&(-oo<b)&&(b<+oo),return(qfa(x->div(f(b-div(x,(1-x))),(1-x)^2),0,1,patience,epsz,wanna_print)));if(wanna_print,print("a=",a,",b=",b,",patience=",patience));fxx=vector(length(qfx29),i,f((a+b)/2+(b-a)/2*qfx29[i]));fx=vector(length(qfx15),i,fxx[2*i-1]);H=(b-a)/2*sum(i=1,length(qfx29),qfc29[i]*fxx[i]);L=(b-a)/2*sum(i=1,length(qfx15),qfc15[i]*fx[i]);if(abs(L-H)<epsz,return(H));if(patience>0,return(qfa(f,a,(a+b)/2,patience-1,epsz,wanna_print)+qfa(f,(a+b)/2,b,patience-1,epsz,wanna_print)));return(H);

/* Sample run.

\p38
#
qfa(exp,-oo,0)-1
qfa(x->exp(-Pi*x^2),-oo,oo)-1
qfa(x->1/(1+x^2))/(Pi/4)-1
qfa(x->abs(x-0.1),0,1,60,1e-38)/0.41-1
qfa(x->x*if(0==x,0,log(x)),0,1,51,1e-38)/-0.25-1
qfa(x->qfa(y->(1+x^2+y^2)^-3,-oo,oo),-oo,oo)/(Pi/2)-1
qfa(x->cos(1e5*x),0,1,20,1e-36)/(sin(1e5)/1e5)-1
*/
